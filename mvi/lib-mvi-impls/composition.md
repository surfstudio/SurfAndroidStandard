[Главная страница репозитория](../../docs/main.md)

# Композиция
Композиция событий - один из вариантов реализации переиспользования логики в mvi.

Так как экраны явно типизированы по sealed-классу событий, из-за закрытости этих классов бывает 
достаточно проблематично настроить переиспользуемую логику.

Обычно, это значит, что Middleware экрана должен быть унаследован от какого-то интерфейса с логикой, 
а все переиспользуемые события должны наследоваться от интерфейсов переиспользуемых событий.

То есть, при реализации навигации, нам придется явно указывать, 
что наша Middleware главного экрана наследуется от NavigationMiddlewareInterface, 
а все события, которые отвечают за навигацию, наследуются от интерфейсов OpenScreenEvent/CloseScreenEvent, и их производных. 
Таким образом, если нам на экране нужно открывать экран, закрывать activity, показывать dialog и фрагмент, 
это уже будет 4 разных события. 

На практике, это рождает большое количество шаблонного кода, и может быть заменено на другой подход: 

Заводится родительское событие, которое наследуется от интерфейса CompositionEvent и от события экрана T. 
В этом событии расположен список дочерних событий, которые не типизированы по экрану. Для навигации это будут наследники интерфейса NavigationEvent.

В случае навигации, это выглядит так: 

    sealed class MainEvent: Event { 
    
        data class Navigation(override var events: List<NavigationEvent> = listOf()) : NavigationComposition, MainEvent()
    }    

После этого, мы создаем Middleware, который будет работать с дочерними событиями (например, реализация NavigationMiddleware, работающая с NavigationEvent). 

И в нашем middleware экрана, в списке трансформаций, мы добавляем строку

    Navigation::class decomposeTo navigationMiddleware
    
Эта строка делает следующее: при каждом эмите в EventHub события Navigation, она извлекает дочерние события, и направляет в navigationMiddleware.
После того, как navigationMiddleware каким-то образом трансформировал их, и готов отдать результат, этот результат кладется в родительское событие Navigation, и отправляется в Middleware главного экрана.

Таким образом, можно показать схему композиции следующим образом: 

`Composition<E>` >> `E` >> `Middleware<E>` >>`E` >> `Composition<E>`